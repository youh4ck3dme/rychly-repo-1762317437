---
export interface Props {
  start?: number;
  end: number;
  duration?: number;
  class?: string;
}

const { start = 0, end, duration = 2000, class: cls = '' } = Astro.props;
---

<span class={`animated-counter ${cls}`} data-end={end} data-start={start} data-duration={duration}>
  {start}
</span>

<script type="module" client:load>
  (function () {
    const el = document.querySelector('.animated-counter');
    if (!el) return;
    const end = parseInt(el.dataset.end, 10) || 0;
    const start = parseInt(el.dataset.start, 10) || 0;
    const duration = parseInt(el.dataset.duration, 10) || 2000;
    const startTime = performance.now();

    function tick(now) {
      const progress = Math.min((now - startTime) / duration, 1);
      const value = Math.floor(start + (end - start) * progress);
      el.textContent = value;
      if (progress < 1) requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
  })();
</script>

<style>
.animated-counter {
  display: inline-block;
  font-variant-numeric: tabular-nums;
}
</style>
